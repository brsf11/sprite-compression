#include<stdio.h>
#include"packagemerge.h"
#include"lzb.h"

#define numS 512

int main()
{
    LZB lzb;
    unsigned char source[numS]={0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0xff,0xff,0xff,
                                0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,
                                0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0xff,0xff,0xff,
                                0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0xff,0xff,0xff,
                                0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,
                                0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0xff,0xff,0xff,
                                0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0xff,0xff,0xff,
                                0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,
                                0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0xff,0xff,0xff,
                                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0xff,0xff,0xff,
                                0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0xff,0xff,0xff,
                                0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,
                                0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0xff,0xff,0xff,
                                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0xff,0xff,0xff,
                                0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0xff,0xff,0xff,
                                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0xff,0xff,0xff,
                                0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0xff,0xff,0xff,
                                0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,
                                0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0xff,0xff,0xff,
                                0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0xff,0xff,0xff,
                                0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,
                                0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0xff,0xff,0xff,
                                0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0xff,0xff,0xff,
                                0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,
                                0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0xff,0xff,0xff,
                                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0xff,0xff,0xff,
                                0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0xff,0xff,0xff,
                                0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,
                                0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0xff,0xff,0xff,
                                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0xff,0xff,0xff,
                                0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0xff,0xff,0xff,
                                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0xff,0xff,0xff
                            };
    unsigned char source_4b[numS*2];
    
    unsigned char codeLen[2];
    unsigned char litTree[29],distTree[16],uniTree[45];
    unsigned char uniSq[45];
    unsigned char litCode[29],distCode[16],uniCode[45],CCL[10],sqCode[10];
    unsigned char Bitstream[numS];
    unsigned seq[numS*2],sqHist[10];
    LZSeq lzseq[numS*2];

    lzb.source    = source;
    lzb.numSource = numS;
    
    lzb.source_4b = source_4b;
    lzb.lzseq     = lzseq;
    lzb.codeLen   = codeLen;
    lzb.litTree   = litTree;
    lzb.distTree  = distTree;
    lzb.litCode   = litCode;
    lzb.distCode  = distCode;
    lzb.seq       = seq;
    lzb.uniTree   = uniTree;
    lzb.uniCode   = uniCode;
    lzb.uniSq     = uniSq;
    lzb.CCL       = CCL;
    lzb.sqHist    = sqHist;
    lzb.sqCode    = sqCode;
    lzb.Bitstream = Bitstream;

    LZBPrepare(&lzb);

    unsigned BSLen = genBitstream(&lzb);
    
    int i;

    for(i=0;i<lzb.lzbSeqLen;i++)
    {
        if(lzb.lzseq[i].len != 0)
        {
            printf("%2d %2d|",lzb.lzseq[i].len,lzb.lzseq[i].dist);
        }
        else
        {
            printf("%2d|",lzb.lzseq[i].ch);
        }
    }
    printf("\n");

    for(i=0;i<lzb.seqLen;i++)
    {
        printf("%2d",lzb.seq[i]);
    }
    printf("\n");

    for(i=0;i<45;i++)
    {
        printf("%2d",lzb.uniCode[i]);
    }
    printf("\n");

    for(i=0;i<45;i++)
    {
        printf("%d",lzb.uniTree[i]);
    }
    printf("\n");

    for(i=0;i<lzb.numSq;i++)
    {
        printf("%d",lzb.uniSq[i]);
    }
    printf("\n");

    for(i=0;i<10;i++)
    {
        printf("%d",lzb.sqHist[i]);
    }
    printf("\n");

    for(i=0;i<10;i++)
    {
        printf("%d",lzb.CCL[i]);
    }
    printf("\n");

    for(i=0;i<10;i++)
    {
        printf("%2d",lzb.sqCode[i]);
    }
    printf("\n");


    for(i=0;i<BSLen;i++)
    {
        printf("%2X ",lzb.Bitstream[i]);
    }
    printf("\n");




    return 0;
}